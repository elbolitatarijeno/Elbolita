<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Calendar with Notes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 1px;
        }
        h1 {
            margin: 1px;
            font-size: 20px;
        }
        .navigation {
            margin: 1px;
        }
        .date-display {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 6px;
        }
        table {
            border-collapse: collapse;
            margin: auto;
            width: 100%;
        }
        td {
            border: 1px solid #aaa;
            padding: 5px 0px 0px 0px;
            width: 1px;
            height: 100px;
            text-align: center;
            vertical-align: bottom;
        }
        th {
            background-color: #f2f2f2;
	        width: 1%;
        }
        td {
            position: relative;
        }
        .today {
            background-color: #ffeb3b;
        }
        textarea {
            width: 93%;
            height: 75%;
            resize: none;
            margin-top: 1px;
            font-size: 12px;
	        font-family: Microsoft Yi Baiti;
	        font-weight: bold;
	        overflow: hidden;
        }
    </style>
</head>
<body>
    <h1>Agenda Calendario</h1>
    <div class="navigation">
        <button onclick="changeMonth(-1)">Atras</button>
        <button onclick="goToToday()">Hoy</button>
        <button onclick="changeMonth(1)">Siguiente</button>
	<button href="./Corregido.html">Otro calendario</button>
    </div>
    <div id="dateDisplay" class="date-display"></div>
    <table id="calendarTable"></table>

    <script>
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth() + 1;
        const monthNames = [
            "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
            "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
        ];
        const daysOfWeek = ["Dom", "Lun", "Mar", "Mier", "Jue", "Vier", "Sab"];
        const notes = JSON.parse(localStorage.getItem("calendarNotes")) || {};

        function updateDateDisplay(year, month) {
            document.getElementById("dateDisplay").textContent = `${monthNames[month - 1]} ${year}`;
        }

        function getFirstDayOfMonth(year, month) {
            return new Date(year, month - 1, 1).getDay(); // Correct way to get the first weekday
        }

        function generateMonthCalendar(year, month) {
            updateDateDisplay(year, month);
            const daysInMonth = new Date(year, month, 0).getDate();

            const table = document.getElementById("calendarTable");
            table.innerHTML = "";

            const headerRow = document.createElement("tr");
            daysOfWeek.forEach(day => {
                const th = document.createElement("th");
                th.textContent = day;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            let row = document.createElement("tr");
            const firstDayIndex = getFirstDayOfMonth(year, month);

            for (let i = 0; i < firstDayIndex; i++) {
                row.appendChild(document.createElement("td"));
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement("td");
                const today = new Date();
                if (day === today.getDate() && month === today.getMonth() + 1 && year === today.getFullYear()) {
                    cell.classList.add("today");
                }

                cell.innerHTML = `<div>${day}</div>`;
                const noteKey = `${year}-${month}-${day}`;
                const textArea = document.createElement("textarea");
                textArea.value = notes[noteKey] || "";
                textArea.oninput = () => saveNote(noteKey, textArea.value);

                cell.appendChild(textArea);
                row.appendChild(cell);

                if ((firstDayIndex + day) % 7 === 0) {
                    table.appendChild(row);
                    row = document.createElement("tr");
                }
            }

            if (row.children.length > 0) {
                table.appendChild(row);
            }
        }

        function changeMonth(change) {
            currentMonth += change;
            if (currentMonth > 12) {
                currentMonth = 1;
                currentYear++;
            } else if (currentMonth < 1) {
                currentMonth = 12;
                currentYear--;
            }
            generateMonthCalendar(currentYear, currentMonth);
        }

        function saveNote(noteKey, value) {
            notes[noteKey] = value;
            localStorage.setItem("calendarNotes", JSON.stringify(notes));
        }

        function goToToday() {
            currentYear = new Date().getFullYear();
            currentMonth = new Date().getMonth() + 1;
            generateMonthCalendar(currentYear, currentMonth);
        }

        generateMonthCalendar(currentYear, currentMonth);
    </script>
</body>
</html>
